<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Koloniale Spuren Osnabrück | Digitale Stadtführung</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Leaflet Routing Machine -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;600&display=swap');

        :root {
            --vintage-paper: #f4f1ea;
            --charcoal: #2d3436;
            --accent-gold: #a67c00;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--vintage-paper);
            color: var(--charcoal);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        h1, h2, h3, .font-serif { font-family: 'Crimson Pro', serif; }

        #map { flex-grow: 1; z-index: 1; }

        .custom-popup .leaflet-popup-content-wrapper {
            background: var(--vintage-paper);
            color: var(--charcoal);
            border-radius: 4px;
            border: 1px solid var(--accent-gold);
        }

        .sidebar { transition: transform 0.3s ease-in-out; z-index: 1000; }

        .station-card:hover {
            border-left: 4px solid var(--accent-gold);
            background: rgba(166, 124, 0, 0.05);
        }

        .leaflet-control-layers {
            border-radius: 8px !important;
            border: none !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
        }

        /* Versteckt die Text-Anweisungen der Route für saubere Screenshots */
        .leaflet-routing-container { display: none !important; }

        /* Navigator Panel Styling */
        #navigator-panel {
            z-index: 1000;
        }

        #nav-info-card {
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            backdrop-filter: blur(8px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Intro Overlay Animation */
        #intro-overlay {
            transition: opacity 0.8s ease-in-out, visibility 0.8s;
        }
        #intro-overlay.fade-out {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        
        /* Animation für den Hinweis-Pfeil */
        @keyframes bounce-up-down {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(6px); }
        }
        .animate-bounce-slow {
            animation: bounce-up-down 1.5s infinite ease-in-out;
        }
        
        .intro-frame {
            border: 1px solid rgba(166, 124, 0, 0.3);
            pointer-events: none;
        }

        /* --- TUTORIAL STYLES --- */
        #tutorial-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 9000;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
        }

        #tutorial-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        #tutorial-spotlight {
            position: absolute;
            border: 2px solid var(--accent-gold);
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.75);
            border-radius: 8px;
            transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
            pointer-events: none;
        }

        #tutorial-tooltip {
            position: absolute;
            width: 300px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            pointer-events: auto;
            transition: all 0.4s ease;
            z-index: 9002;
        }

        /* --- ALLGEMEINES MODAL STYLING (für Literatur & Stationen) --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(45, 52, 54, 0.85);
            backdrop-filter: blur(4px);
            z-index: 8000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: var(--vintage-paper);
            width: 95%;
            max-width: 650px;
            max-height: 85vh;
            overflow-y: auto;
            padding: 0; 
            border-radius: 8px;
            border: 1px solid var(--accent-gold);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transform: scale(0.95);
            transition: transform 0.3s ease;
            position: relative;
        }
        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        /* SPEZIALSTYLES FÜR STATION MODAL (Verschiebbar) */
        #station-overlay {
            background: none !important; /* Kein dunkler Hintergrund */
            backdrop-filter: none !important;
            pointer-events: none; /* Klicks gehen durch den leeren Bereich durch */
        }
        
        #station-overlay .modal-content {
            pointer-events: auto; /* Box selbst ist klickbar */
            position: absolute; /* Wichtig für Drag & Drop */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Startzentrierung */
            margin: 0;
            /* Der gewünschte dünne Rahmen + Schatten */
            box-shadow: 0 0 0 2px #fff, 0 0 0 3px var(--accent-gold), 0 15px 40px rgba(0,0,0,0.4);
            border: none;
        }

        /* --- STYLES FÜR BILDER IM FLIESSTEXT --- */
        #modal-content-text img {
            margin: 1.5rem 0;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #e5e5e5;
            width: 100%;
            height: auto;
            display: block;
        }
        #modal-content-text figure {
            margin: 2rem 0;
        }
        #modal-content-text figcaption {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
            margin-top: 0.5rem;
            font-family: 'Inter', sans-serif;
            font-style: italic;
        }

        .modal-drag-handle {
            height: 32px;
            background: #fdfcf9;
            border-bottom: 1px solid #e5e5e5;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px 8px 0 0;
            color: #ccc;
        }
        .modal-drag-handle:hover {
            background: #f4f1ea;
            color: var(--accent-gold);
        }
        
        /* Schließen-Button */
        .modal-close-btn {
            position: absolute;
            top: 10px; 
            right: 10px;
            background: white; 
            border: 1px solid #e5e5e5; 
            border-radius: 50%;
            padding: 8px; 
            z-index: 20;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #2d3436;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        }
        .modal-close-btn:hover {
            background: var(--accent-gold); 
            color: white;
            transform: rotate(90deg); 
            border-color: var(--accent-gold);
            box-shadow: 0 4px 8px rgba(166, 124, 0, 0.3);
        }

        /* Arrival Prompt Styling */
        #arrival-prompt {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #arrival-prompt.visible {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Pulse Animation für Zielzone */
        @keyframes pulse-red {
            0% { opacity: 0.4; transform: scale(0.8); }
            50% { opacity: 0.7; transform: scale(1.1); }
            100% { opacity: 0.4; transform: scale(0.8); }
        }
        .arrival-marker {
            animation: pulse-red 2s infinite;
        }

        /* --- MARKER STYLES --- */
        .number-icon {
            background-color: #fdfcf9;
            color: #2d3436;
            border: 2px solid #a67c00;
            border-radius: 50%;
            text-align: center;
            line-height: 30px; 
            font-family: 'Crimson Pro', serif;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }
        .number-icon:hover {
            transform: scale(1.15);
            background-color: #a67c00;
            color: #fff;
            border-color: #a67c00;
            box-shadow: 0 6px 12px rgba(166, 124, 0, 0.3);
        }

        /* Styling für Audio Player - Custom UI */
        audio::-webkit-media-controls-panel {
            background-color: #f4f1ea;
        }

        /* Fullscreen Image Overlay */
        #fullscreen-overlay {
            transition: opacity 0.3s ease-in-out, visibility 0.3s;
        }
        #fullscreen-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            display: flex !important; /* Keep flex for centering, just hide vis */
            pointer-events: none;
        }
        #fullscreen-overlay:not(.hidden) {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }
    </style>
</head>
<body>

    <!-- LITERATUR MODAL (Bleibt Standard) -->
    <div id="lit-overlay" class="modal-overlay">
        <div class="modal-content p-8 relative">
            <button id="closeLit" class="modal-close-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            
            <h2 class="text-2xl font-serif border-b border-[#a67c00] pb-2 mb-6 text-[#2d3436]">Literatur & Quellen</h2>
            
            <div class="space-y-6 text-sm text-gray-700 font-light leading-relaxed">
                <p class="italic text-xs text-gray-500 mb-4">Verwendete Literatur für dieses Projekt.</p>
                
                <!-- NEU EINGEFÜGT: Gröpl -->
                <div class="pl-4 border-l-2 border-gray-300">
                    <p>Gröpl, Myriam. Repräsentationen des Anderen – Museen und Völkerschauen. URL: https://geschichtsbuch.hamburg.de/epochen/kolonialismus/577-2/ [zuletzt aufgerufen am 13.01.2026].</p>
                </div>

                <div class="pl-4 border-l-2 border-gray-300">
                    <p>Günther, Carsten. Völkerschauen und Kolonialausstellung. 2025. URL: https://www.planet-wissen.de/geschichte/deutsche_geschichte/deutsche_kolonien/voelkerschauen-und-kolonialausstellung-100.html [zuletzt aufgerufen am 13.01.2026].</p>
                </div>

                <div class="pl-4 border-l-2 border-gray-300">
                    <p>Heyden, Ulrich van der; Zeller, Joachim (Hrsg.). Kolonialismus hierzulande. 2007. Erfurt. Sutton Verlag.</p>
                </div>
                 <div class="pl-4 border-l-2 border-gray-300">
                    <p>Hoffmeyer, Ludwig. Chronik der Stadt Osnabrück. 1982. Vierte Auflage. Osnabrück. Druck und Verlag Meinders&Elstermann. S. 96ff.</p>
                </div>
                 <div class="pl-4 border-l-2 border-gray-300">
                    <p>Ismard, Paulin (Hrsg.). Welten der Sklaverei. 2023. Berlin. Verlagshaus Jacoby&Stuart.</p>
                </div>
                 <div class="pl-4 border-l-2 border-gray-300">
                    <p>Kühling, Karl. Die Juden in Osnabrück. 1983. Osnabrück. T.H. Wenner Verlag.</p>
                </div>

                <div class="pl-4 border-l-2 border-gray-300">
                    <p>Ruprecht, Anne; Seekamp, Mirco. Menschenzoo im Tierpark: Hagenbecks verdrängtes Erbe. 2022. URL: https://www.ndr.de/kultur/kunst/provenienzforschung/Menschenzoo-im-Tierpark-Hagenbecks-verdraengtes-Erbe,hagenbeck1440.html [zuletzt aufgerufen am 13.01.2026].</p>
                </div>

                 <div class="pl-4 border-l-2 border-gray-300">
                    <p>Schipmann, Johannes Ludwig. Osnabrück und die Hanse. 2006. Bramsche. Rasch Verlag. S. 69.</p>
                </div>
                 <div class="pl-4 border-l-2 border-gray-300">
                    <p>Wagner, Gisela. Osnabrück als Stadt der Hanse. 1980. Osnabrück. Selbstverlag des Vereins für Geschichte und Landeskunde.</p>
                </div>
                 <div class="pl-4 border-l-2 border-gray-300">
                    <p>Weipert, Matthias; Groth, Daniel; Fenske, Uta (Hrsg.). Grenzgang. Grenzgängerinnen. Grenzgänger. 2017. Mörlenbach. Röhrig Universitätsverlag.</p>
                </div>

                <div class="pl-4 border-l-2 border-gray-300">
                    <p>Zeitler, Annika. Völkerschauen: Menschen zur Schau gestellt wie im Zoo. 2017. URL: https://www.dw.com/de/v%C3%B6lkerschauen-menschen-zur-schau-gestellt-wie-im-zoo/a-17187997 [zuletzt aufgerufen am 13.01.2026].</p>
                </div>
                
                <div class="mt-8 pt-4 border-t border-gray-200 text-xs text-gray-400">
                    <p>Alle Rechte vorbehalten.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- STATION DETAIL MODAL (DRAGGABLE) -->
    <div id="station-overlay" class="modal-overlay">
        <div id="station-modal-content" class="modal-content">
            <!-- DRAG HANDLE -->
            <div id="station-drag-handle" class="modal-drag-handle">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
            </div>

            <button id="closeStation" class="modal-close-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            
            <!-- Bild-Container (Hauptbild) -->
            <div id="modal-image-container" class="w-full bg-[#e5e5e5] relative flex justify-center items-center min-h-[200px] cursor-zoom-in group" title="Klicken für Vollbild">
                <!-- Bild kommt hier rein -->
            </div>
            
            <!-- Bildnachweis / Copyright -->
            <div id="modal-image-copyright" class="w-full px-4 py-1 bg-gray-50 text-[10px] text-gray-500 text-right italic hidden border-b border-gray-100"></div>

            <div class="p-8">
                <h2 id="modal-title" class="text-3xl font-serif text-[#2d3436] mb-4"></h2>
                
                <!-- Multimedia Sektion -->
                <div id="modal-media" class="mb-6 hidden bg-white p-4 rounded border border-gray-200 shadow-sm">
                    <!-- Audio & 3D kommen hier rein -->
                </div>

                <div id="modal-content-text" class="prose prose-sm max-w-none text-gray-700 leading-relaxed space-y-4">
                    <!-- Text kommt hier rein -->
                </div>

                <!-- Footer Navigation im Modal -->
                <div class="mt-8 pt-6 border-t border-gray-200 flex flex-col gap-3">
                    
                    <!-- Next Station Button -->
                    <button id="modal-next-btn" class="w-full bg-[#a67c00] text-white py-3 rounded-lg flex justify-center items-center hover:bg-[#856300] transition group font-bold">
                        <span>Zur nächsten Station</span>
                        <svg class="ml-2 group-hover:translate-x-1 transition-transform" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                    </button>

                    <!-- Start Navigation to THIS station -->
                    <button id="modal-navigate-btn" class="w-full bg-[#fdfcf9] border border-gray-300 text-charcoal py-2 rounded-lg flex justify-center items-center hover:bg-gray-50 transition text-sm">
                        <svg class="mr-2" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s-8-4.5-8-11.8A8 8 0 0 1 12 2a8 8 0 0 1 8 8.2c0 7.3-8 11.8-8 11.8z"/><circle cx="12" cy="10" r="3"/></svg>
                        Navigation hierher starten
                    </button>

                    <!-- NEU: Rundgang beenden Button -->
                    <button id="modal-end-btn" class="w-full bg-white border border-red-200 text-red-900/70 py-2 rounded-lg flex justify-center items-center hover:bg-red-50 hover:text-red-800 transition text-sm mt-2">
                        <svg class="mr-2" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><rect x="9" y="9" width="6" height="6"></rect></svg>
                        Rundgang hier beenden
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- NEU: END TOUR OVERLAY (Platzhalter) -->
    <div id="end-tour-overlay" class="modal-overlay">
        <div class="modal-content p-8 relative max-w-md text-center">
            <button id="closeEndTour" class="modal-close-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            
            <div class="flex justify-center mb-6">
                <div class="bg-[#a67c00] text-white p-4 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                </div>
            </div>

            <h2 class="text-2xl font-serif text-[#2d3436] mb-4">Vielen Dank für Ihre Teilnahme</h2>
            
            <div class="text-gray-600 space-y-4 mb-8 text-sm leading-relaxed">
                <p>Ich hoffe, Ihnen hat der digitale Rundgang gefallen. Für weitere Fragen oder Anmerkungen schreiben Sie mir gerne per Mail: <a href="mailto:jhsinger@outlook.de" class="text-[#a67c00] hover:underline font-bold">jhsinger@outlook.de</a>.</p>
                
                <p>Falls Sie sich weiter für dieses Thema interessieren und einen tieferen und immersiveren Einblick wünschen, empfehle ich Ihnen die Führung "Osnabrück post-kolonial – eine Spurensuche mit Dr. Thorsten Heese" zu besuchen, da diese einen deutlich detaillierteren Einblick in das koloniale Osnabrück bietet.</p>
                
                <p>Ansonsten besuchen Sie gerne meine Web-App bald wieder, es stehen noch einige Erweiterungen, u. a. die Vertonung aller Stationen oder das Bereitstellen von 3D-Scans, aus.</p>
                
                <p class="font-serif italic text-base mt-4 text-[#2d3436]">Viele Grüße<br>Jannik Singer</p>
            </div>

            <button id="confirmEndTour" class="w-full bg-[#2d3436] text-white py-3 rounded-lg hover:bg-[#a67c00] transition font-bold">
                Zurück zur Startseite
            </button>
        </div>
    </div>

    <!-- FULLSCREEN IMAGE OVERLAY -->
    <div id="fullscreen-overlay" class="fixed inset-0 z-[9999] bg-black hidden flex justify-center items-center">
        <button id="closeFullscreen" class="absolute top-6 left-6 text-white bg-black/50 px-4 py-2 rounded-full hover:bg-white/20 transition flex items-center gap-2 backdrop-blur-sm border border-white/30 font-medium">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
            Zurück
        </button>
        <img id="fullscreen-image" src="" alt="Vollbild" class="max-w-full max-h-full object-contain p-4">
    </div>

    <!-- TUTORIAL OVERLAY -->
    <div id="tutorial-overlay">
        <div id="tutorial-spotlight"></div>
        <div id="tutorial-tooltip">
            <h4 id="tut-title" class="text-[#a67c00] font-bold uppercase text-xs tracking-wider mb-2">Schritt 1</h4>
            <p id="tut-text" class="text-charcoal text-sm leading-relaxed mb-4">Erklärungstext hier.</p>
            <div class="flex justify-between items-center border-t border-gray-100 pt-3">
                <button id="tut-skip" class="text-xs text-gray-400 hover:text-gray-600">Überspringen</button>
                <button id="tut-next" class="bg-[#2d3436] text-white text-xs px-4 py-2 rounded hover:bg-[#a67c00] transition-colors">Weiter</button>
            </div>
        </div>
    </div>

    <!-- ARRIVAL PROMPT -->
    <div id="arrival-prompt" class="fixed bottom-24 right-6 bg-white p-4 rounded-xl shadow-2xl border-l-4 border-[#a67c00] z-[2000] hidden transform translate-y-10 opacity-0 w-72">
        <div class="flex justify-between items-start">
            <div>
                <h4 class="font-bold text-[#2d3436] text-sm uppercase tracking-wide">Station erreicht!</h4>
                <p id="arrival-station-name" class="text-xs text-gray-600 mt-1 mb-3 font-serif italic text-lg leading-tight">Station Name</p>
            </div>
            <button id="closeArrival" class="text-gray-400 hover:text-gray-600 p-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        </div>
        <button id="openArrival" class="w-full bg-[#a67c00] hover:bg-[#856300] text-white text-sm font-medium py-2 rounded shadow-sm transition flex items-center justify-center gap-2">
            Inhalt ansehen 
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12h10"/><path d="M9 4v16"/><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><path d="M9 22V12h6v10"/></svg>
        </button>
    </div>

    <!-- Full Screen Intro Overlay -->
    <div id="intro-overlay" class="fixed inset-0 z-[5000] bg-[#f4f1ea] flex flex-col justify-center items-center overflow-y-auto">
        <div class="absolute inset-4 intro-frame z-0"></div>
        <div class="absolute inset-6 intro-frame z-0"></div>

        <div class="relative z-10 max-w-7xl w-full px-8 md:px-12 py-12 flex flex-col md:flex-row gap-8 lg:gap-16 items-center h-full justify-center">
            <div class="md:w-1/3 text-center md:text-left space-y-6">
                <div class="inline-block border-b-2 border-[#a67c00] pb-2 mb-2">
                    <span class="text-[#a67c00] text-sm font-bold uppercase tracking-[0.25em]">Universität Osnabrück</span>
                </div>
                <h1 class="text-5xl md:text-6xl lg:text-7xl font-serif text-[#2d3436] leading-[1.1]">
                    Koloniale<br><span class="italic text-[#a67c00]">Spuren</span><br>Osnabrück
                </h1>
                <!-- Untertitel entfernt -->
            </div>
            <div class="md:w-2/3 w-full space-y-8 bg-white/60 backdrop-blur-md p-10 md:p-12 border-l-4 border-[#a67c00] shadow-sm rounded-r-lg">
                <div class="prose prose-lg md:prose-xl text-gray-700 leading-relaxed font-serif max-w-none">
                    <p>Herzlich willkommen zum Web-App-Slam! Ich freue mich, dass Sie sich für meine Web-App interessieren, und lade Sie herzlich ein, sich ein wenig mit der Geschichte des Kolonialismus zu beschäftigen.</p>
                    <p>Die App soll keine Abhandlung über koloniale Verflechtungen in Osnabrück ausführen, sondern interaktiv aufzeigen, wie Osnabrück im Kolonialismus profitierte und wo man heute noch Überreste finden kann.</p>
                    <p class="text-base italic text-gray-500 mt-4 border-t border-gray-200 pt-4">Die App befindet sich noch in einem experimentellen Zustand. Wenn Sie wissen wollen, was noch gemacht werden muss, fragen Sie gerne bei mir nach!</p>
                </div>
                <div class="pt-4">
                    <button id="closeIntro" class="group w-full md:w-auto bg-[#2d3436] text-white px-8 py-4 text-lg font-medium tracking-wide hover:bg-[#a67c00] transition-colors duration-300 flex items-center justify-center md:justify-start gap-4 shadow-lg rounded-sm">
                        <span>Rundgang beginnen</span>
                        <svg class="transform group-hover:translate-x-2 transition-transform duration-300" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                    </button>
                    <p class="text-[10px] text-gray-400 mt-4 uppercase tracking-wider">Version Web-App-Slam</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header id="main-header" class="bg-[#2d3436] text-white p-4 shadow-md flex justify-between items-center relative z-[1001]">
        <div>
            <h1 class="text-xl md:text-2xl font-semibold tracking-tight font-serif">Koloniale Spurensuche in Osnabrück</h1>
        </div>
        <div class="flex items-center gap-4">
            <button id="openLit" class="text-xs md:text-sm text-gray-300 hover:text-[#a67c00] hover:bg-white/10 px-3 py-1 rounded transition-colors flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                <span class="hidden md:inline decoration-dotted underline underline-offset-4">Hier gehts zur Literaturliste</span>
                <span class="md:hidden">Literatur</span>
            </button>
            <button id="toggleSidebar" class="md:hidden bg-accent-gold p-2 rounded">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
            </button>
        </div>
    </header>

    <main class="flex flex-1 relative overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar absolute md:relative w-full md:w-96 bg-[#fdfcf9] border-r border-gray-200 h-full overflow-y-auto transform -translate-x-full md:translate-x-0 shadow-xl">
            <div class="p-6">
                <div id="intro-view">
                    <h2 class="text-2xl mb-4 border-b border-gray-200 pb-2 font-serif">Stationen der Tour</h2>
                    <p class="text-sm text-gray-600 mb-6">Wählen Sie einen Ort, um mehr über koloniale Verflechtungen zu erfahren.</p>
                    <div id="station-list" class="space-y-4"></div>
                </div>
            </div>
        </aside>

        <!-- Map -->
        <div id="map"></div>

        <!-- Navigator Overlay -->
        <div id="navigator-panel" class="absolute bottom-6 right-6 flex flex-col items-end gap-3 pointer-events-none">
            <div id="nav-info-card" class="bg-white/95 p-4 rounded-xl border border-gray-200 w-64 md:w-72 pointer-events-auto shadow-2xl">
                <div id="nav-initial-state">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-[10px] uppercase tracking-widest text-accent-gold font-bold italic">Navigator</span>
                        <div class="h-2 w-2 rounded-full bg-red-500 animate-pulse"></div>
                    </div>
                    <h4 class="text-sm font-bold text-charcoal">Routenplaner</h4>
                    <p class="text-[11px] text-gray-500 mt-1 leading-snug">Aktivieren Sie Ihren Standort, um Entfernungen und Gehzeiten zu den Stationen zu sehen.</p>
                    <div class="flex justify-end pr-4 mt-4">
                        <svg class="animate-bounce-slow text-accent-gold" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
                    </div>
                </div>
                <div id="nav-active-state" class="hidden">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-[10px] uppercase tracking-widest text-accent-gold font-bold">Nächste Station</span>
                        <span id="nav-dist" class="text-xs font-mono bg-gray-100 px-2 py-1 rounded">-- m</span>
                    </div>
                    <h4 id="nav-next-title" class="text-sm font-bold truncate">Berechne...</h4>
                    <div class="grid grid-cols-2 gap-2 mt-4 pt-3 border-t border-gray-100">
                        <div>
                            <p class="text-[9px] text-gray-400 uppercase">Gehzeit ca.</p>
                            <p id="nav-time" class="text-sm font-semibold text-charcoal">-- Min.</p>
                        </div>
                        <div>
                            <p class="text-[9px] text-gray-400 uppercase">Status</p>
                            <p id="nav-status-text" class="text-sm font-semibold text-green-600 flex items-center">
                                <span class="h-1.5 w-1.5 rounded-full bg-green-600 mr-1"></span> Aktiv
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <button id="locateMe" class="bg-white p-4 rounded-full shadow-lg border border-gray-100 hover:bg-gray-50 active:scale-90 transition-all pointer-events-auto group relative">
                <span class="absolute -top-12 right-0 bg-charcoal text-white text-[10px] py-1 px-3 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">GPS aktivieren</span>
                <svg id="gps-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#a67c00" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="3"></circle><line x1="12" y1="2" x2="12" y2="4"></line><line x1="12" y1="20" x2="12" y2="22"></line><line x1="2" y1="12" x2="4" y2="12"></line><line x1="20" y1="12" x2="22" y2="12"></line></svg>
            </button>
        </div>
    </main>

    <div id="toast" class="fixed bottom-32 left-1/2 transform -translate-x-1/2 bg-gray-900 text-white px-6 py-2 rounded-full text-xs opacity-0 transition-opacity z-[2000] pointer-events-none shadow-2xl">
        Standort wird abgerufen...
    </div>

    <script>
        // DRAG FUNKTION (Verschiebbarkeit)
        function makeDraggable(elmnt) {
            var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            if (document.getElementById("station-drag-handle")) {
                // If present, the header is where you move the DIV from:
                document.getElementById("station-drag-handle").onmousedown = dragMouseDown;
            } else {
                // Otherwise, move the DIV from anywhere inside the DIV:
                elmnt.onmousedown = dragMouseDown;
            }

            function dragMouseDown(e) {
                e = e || window.event;
                e.preventDefault();
                // Get the mouse cursor position at startup:
                pos3 = e.clientX;
                pos4 = e.clientY;
                
                // FIX: Get precise current position to avoid jumping
                const rect = elmnt.getBoundingClientRect();
                
                // Freeze the element at its current visual position using fixed pixels
                // This replaces the "50% / -50%" centering logic with absolute coordinates
                elmnt.style.left = rect.left + "px";
                elmnt.style.top = rect.top + "px";
                elmnt.style.transform = "none"; 
                elmnt.style.margin = "0";

                document.onmouseup = closeDragElement;
                // Call a function whenever the cursor moves:
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                // Calculate the new cursor position:
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                // Set the element's new position:
                elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
                elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                // Stop moving when mouse button is released:
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        const stations = [
            {
                id: 0,
                title: "Start: So funktioniert der Rundgang",
                coords: [52.2770, 8.0420], 
                short: "Anleitung und Funktionen.",
                image: "", // Bild entfernt
                imageCopyright: "",
                content: `
                    <h3 class="font-bold text-lg mb-2">Herzlich Willkommen!</h3>
                    <p>Dieser digitale Stadtrundgang führt Sie zu den Spuren der kolonialen Vergangenheit in Osnabrück.</p>
                    
                    <h4 class="font-bold mt-4">So nutzen Sie die App:</h4>
                    <ul class="list-disc pl-5 mt-2 space-y-1">
                        <li><strong>Orientierung:</strong> Die Bilder in der App helfen Ihnen, die Orte im heutigen Stadtbild wiederzuerkennen.</li>
                        <li><strong>Audio-Guide:</strong> Sie möchten lieber hören statt lesen? Nutzen Sie den Audio-Player in jedem Fenster.</li>
                        <li><strong>3D-Scans:</strong> Bei ausgewählten Stationen können Sie digitale 3D-Modelle der Objekte betrachten.</li>
                        <li><strong>Flexibler Start:</strong> Sie können an jeder Station beginnen. Der <strong>Navigator</strong> (unten rechts) zeigt Ihnen immer den Weg zum nächstgelegenen Ziel.</li>
                    </ul>
                `,
                audio: "audio/intro.mp3",
                model3d: ""
            },
            { 
                id: 1, 
                title: "Station I: Der Domplatz", 
                coords: [52.27753, 8.04405], 
                short: "Vorplatz des Doms.", 
                image: "images/dom.jpg",
                imageCopyright: "Rolf Kranz",
                
                content: `
                    <p class="mb-4">Ich begrüße Sie herzlich zur ersten Station des digitalen Rundgangs. Sie stehen gerade auf dem Domvorplatz. Hier herrscht in der Regel reger Betrieb. Menschen möchten den Dom besichtigen oder einen Gottesdienst besuchen, es werden sich bestimmt auch Touristen finden lassen. Vielleicht haben Sie das Glück und sehen eine Gruppe, die gerade an einer Führung teilnimmt und die Geschichte des sogenannten „Löwenpudels“ erzählt bekommt. Doch darüber wird es heute nicht gehen. Vielleicht schalten Sie auch gerade von zu Hause aus ein und besuchen die Web-App von Ihrem Sofa aus. In jedem Fall wünsche ich Ihnen viel Spaß und spannende Erkenntnisse rund um die kolonialen Überbleibsel in Osnabrück.</p>

                    <p class="mb-4">Regelmäßig findet beim Dom der Samstags-Wochenmarkt in Osnabrück statt. Hier werden die verschiedensten Sachen verkauft. Handel hat in Osnabrück eine lange Tradition. Osnabrück war nämlich Hansestadt. Damit war man einem mächtigen Handelsbund angehörig, der seit dem Mittelalter existiert. Wer denkt, dass eine Hansestadt am Hafen liegen muss, hat weit gefehlt. Binnenhandel war ein wichtiger Aspekt in der Hanse. Außerdem war Osnabrück für ein bestimmtes, hier gefertigtes Handelsgut bekannt: das Osnabrücker Leinen. Es war bekannt für seine unschlagbare Qualität, vor allem in puncto Rissfestigkeit und Preis-Leistung. Also exportierte man das sogenannte „Löwendlinnen“ über Holland, England und Spanien, die führenden Kolonialnationen dieser Zeit, nach ganz Nord- und Südamerika und in die Karibik. Damit verdiente man sehr gutes Geld und machte sich rund um den Globus einen Namen. Die „true born Osnabrughs“ oder die „Osnabrücker Hosen“ wären so gesehen eine wahre Osnabrücker Erfolgsgeschichte.</p>

                    <!-- BILD 1: Osnabrücker Leinen / Handel -->
                    <figure class="my-8 p-2 bg-gray-50 rounded border border-gray-100">
                        <!-- HIER BILDNAME ÄNDERN -->
                        <img src="images/dreieckshandel.png" alt="Übersicht über den Dreieickshandel" class="mb-2 w-full h-auto rounded shadow-sm" onerror="this.onerror=null; this.src='https://placehold.co/600x400/e2e8f0/475569?text=BILD+NICHT+GEFUNDEN';" />
                        <figcaption>
                            <div class="text-[10px] uppercase tracking-wider text-gray-400 font-bold border-b border-gray-200 pb-1 mb-1">Quelle: Archiv</div>
                            <div class="text-sm italic text-gray-700">Historische Darstellung des Leinenhandels.</div>
                        </figcaption>
                    </figure>

                    <p class="mb-4">Diese Geschichte wird man auch häufiger in Osnabrück antreffen, vorwiegend in Stadtchroniken oder wenn die Stadt die eigene Geschichte erzählen möchte. Was jedoch viel zu selten passiert, ist, dass die Geschichte bis zum Schluss erzählt wird. Die „true born Osnabrughs“ waren nämlich deswegen aufgrund ihrer Rissfestigkeit und ihres Preises beliebt und in aller Munde, weil sie als Sklavenbekleidung dienten. Die versklavten Menschen, die auf Feldern in Amerika und in der Karibik unter härtesten Bedingungen schuften mussten, wurden mit eben diesem Osnabrücker Verkaufsschlager eingekleidet.</p>
                    
                    <p class="mb-4">Infolgedessen profitierte Osnabrück vom sogenannten „Dreieckshandel“ in großen Mengen. Kurz nach dem 30-jährigen Krieg gelangte der erste Sklave aus Afrika nach Osnabrück. Darüber berichte ich dann bei der nächsten Station.</p>
                `,
                audio: "audio/station1.mp3", 
                model3d: "" 
            },
            { 
                id: 2, 
                title: "Station II: Die Marienkirche", 
                coords: [52.27763, 8.04172], 
                short: "Marktplatz und Kirche.", 
                image: "images/marienkirche.jpg",
                imageCopyright: "Quersus",
                
                content: `
                    <p class="mb-4">Sie befinden sich gerade am städtischen Mittelpunkt in Osnabrück. Vor Ihnen steht die Marienkirche, ein imposantes gotisches Bauwerk, dessen Gründung bis ins 10. Jahrhundert reicht. Die Marienkirche hat ganz verschiedene Tätigkeitsbereiche. So werden hier natürlich Gottesdienste gefeiert, gebetet und ein Raum für Gläubige geschaffen. Sie stellt aber auch einige stadtgeschichtlich relevante Objekte aus oder bietet Platz für historische Ausstellungen. Hier werden selbstverständlich auch angehende Christ*innen getauft. Im 17. Jahrhundert wurde hier auch eine Person getauft, soweit so unspektakulär. Womit soll das nun mit dem Kolonialismus zu tun haben?</p>
                    
                    <p class="mb-4">1645 wird ein Mann, dessen Geburtsname uns noch heute verborgen bleibt, an der afrikanischen Westküste geboren. Mit ca. drei Jahren wird er, während er am Strand spielt, von holländischen Soldaten gefangen genommen und entführt. Sie verkaufen ihn in dem heutigen Guinea an einen deutschen Kaufmann weiter. Dieser bringt den mittlerweile elfjährigen Jungen nach Hamburg, wo er dort vom damaligen Bürgermeister Osnabrücks, Gerhard Schepeler, gekauft wurde. Hamburg galt zu dieser Zeit als einer der größten Handelsplätze für Sklaven in der Region. Warum Schepeler den Jungen kaufte, ist bis jetzt nicht bekannt. Sicher ist, dass er eine beträchtliche Summe an Geld zahlen musste, da damals Sklaven als eine Art Statussymbol für Wohlstand in der Gesellschaft standen. Schepeler strebt an, dass sein Sklave „bekehrt“ werden muss und dementsprechend getauft werden solle.</p>

                    <p class="mb-4">Somit erhielt der Junge am 18.05.1661 die Taufe in der Marienkirche. Es ist ein besonderes Ereignis gewesen, dass ein aus Afrika stammender Mensch in Osnabrück getauft wird, auch weil es der erste Beleg eines Sklaven in Osnabrück ist. Schepeler beauftragte auch den Druck eines Buches, welches von der Taufe berichten solle, da die „bekehrung eines Mohren […] an diesem Orte wol etwas newes, und bey Menschen=dencken in dieser Stadt nicht geschehen noch gesehen“ wurde.</p>
                    
                    <p class="mb-4">Bei der Taufe gab man dem Jungen den christlichen Namen Christian Gerhard Schepeler. Christian ist eine Anspielung auf Christus als ein Symbol seiner „Bekehrung“, Gerhard und Schepeler stammen von seinem „Vater“, Gerhard Schepeler. Offiziell ist der Junge, dessen eigentlicher Name wohl für immer verborgen bleiben wird, aus dem Sklavenstand entlassen und frei, da ein Christ kein Sklave sein kann. Man ist sich jedoch bis heute nicht sicher, wie es Schepeler (und damit auch Personen, die sein Schicksal teilen) nach der Taufe erging. Sie wird seine Situation wohl verbessert haben, jedoch ist er als ehemaliger Sklave immer noch ein Außenseiter in der Gesellschaft.</p>
                    
                    <p class="mb-4 border-t border-gray-200 pt-4">Diese Geschichte zeigt deutlich auf, wie Osnabrück im Geflecht des Kolonialismus beteiligt war. Mit Sklaven handelte man schon seit dem 17. Jahrhundert in Osnabrück, die Taufe galt als eine Hauptattraktion für die Stadt. Was Attraktion mit Kolonialismus zu tun hat, werden Sie in den nächsten beiden Kapiteln erfahren. Doch bevor Sie losgehen, lohnt sich noch ein genauerer Blick in die Marienkirche. Finden Sie noch weitere koloniale Überbleibsel oder Darstellungen?</p>
                `,
                audio: "audio/station2.mp3", 
                model3d: "" 
            },
            { 
                id: 3, 
                title: "Station III: Museum und Kolonialismus", 
                coords: [52.27554, 8.03890], 
                short: "Museumsquartier.", 
                image: "images/museum.jpg",
                imageCopyright: "Axel Hindemith",
                
                content: `
                    <p class="mb-4">Vor ihnen befindet sich der Museumskomplex des „Museumsquartiers“.
                    Hier ist, neben der Villa_ und dem Felix-Nussbaum-Haus, auch das kulturgeschichtliche Museum ansässig. Dieses wurde 1890 geöffnet, in der Hochphase des Kolonialismus. Die europäischen Mächte wie Großbritannien. Frankreich, Deutschland oder Belgien
                    konkurrieren um Besitztümer in Afrika und in der ganzen Welt. Warum aber
                    befindet sich diese Station vor dem osnabrücker Museumskomplex?</p>
                    
                    <p class="mb-4">Museen spielten im 19. Jahrhundert in der Gesellschaft eine
                    wichtige Rolle. Im frühen 19. Jahrhundert waren Museen zunächst dafür konzipiert,
                    dass der „Nationalstolz“ in der Bevölkerung gestärkt wird. Ein bekanntes Beispiel dafür ist der Louvre in Paris.</p>
                    
                    <p class="mb-4">Im Laufe der Zeit jedoch schwenkte das Erkenntnisinteresse
                    der Bildungsinstitution „Museum“ auf die Erforschung des „neuen“ und „unbekannten“.
                    Sie strebten treu nach dem Motto „sammeln, erforschen, präsentieren“ nach neuen
                    Objekten und Ausstellungsgegenständen. Das unterscheidet sie von heutigen Museen
                    nicht großartig. Das, was sie jedoch unterscheidet, ist das Wie der Museumsarbeit. Heutige Museen folgen
                    strengen wissenschaftlichen Standards, fördern unser Demokratieverständnis und unser
                    pluralistisches Weltbild.</p>
                    
                    <p class="mb-4">Die Museen aus dem 19. Jahrhundert orientierten sich an dem
                    neuen, dem „exotischen“, und legitimierten ihre Theorien mit dem typischen Kolonialdenken
                    aus der Zeit. Sie erforschten Menschen und Kulturen anhand rassistischer Stereotypen
                    und präsentierten sie getreu dem sozialdarwinistischen Weltbild. Die Museen
                    förderten die kolonialen Fantasien der Kolonialmächte, indem sie ihnen eine
                    wissenschaftliche Legitimation boten, dass Menschen anderer Kulturen oder anderer
                    Hautfarbe weniger wert seien als die Europäer. Gleichzeitig stellten sie in
                    ihren Ausstellungen das neu gewonnene Wissen des „Exotischen“ aus.</p>
                    
                    <p class="mb-4">Ein Beispiel wäre die Schlussfolgerung, dass Menschen, die nicht
                    den gleichen technologischen Fortschritt besäßen, wie das industrielle Europa,
                    automatisch minderwertig und als schlechter zu betrachten seien. Damit
                    versuchte man, den Anspruch der Europäer auf die ganze Welt zu legitimieren,
                    sodass sie nach Belieben über fremdes Land und fremde Menschen verfügen konnten.
                    Häufig profitierten die Museen auch vom Kolonialismus, indem sie Raubgüter
                    erwarben, die unrechtmäßig von Kulturen geraubt wurden. Beispielhaft dafür sind die „Benin-Bronzen“, welche im 19. Jahrhundert von Großbritannien aus Afrika
                    gestohlen und an ein Berliner Museum verkauft wurden. Dort lagen die Kulturgüter
                    knapp 100 Jahre, ehe das Raubgut wieder rechtmäßig an Namibien zurückgegeben
                    wurde.</p>

                    <!-- BILD PLATZHALTER BENIN BRONZEN -->
                    <figure class="my-8 p-2 bg-gray-50 rounded border border-gray-100">
                        <!-- HIER BILDNAME ÄNDERN -->
                        <img src="images/station3_benin_bronze.jpg" alt="Benin Bronzen" class="mb-2 w-full h-auto rounded shadow-sm" onerror="this.onerror=null; this.src='https://placehold.co/600x400/e2e8f0/475569?text=BILD+NICHT+GEFUNDEN';" />
                        <figcaption>
                            <div class="text-[10px] uppercase tracking-wider text-gray-400 font-bold border-b border-gray-200 pb-1 mb-1">Quelle: Archiv</div>
                            <div class="text-sm italic text-gray-700">Beispielhafte Darstellung der Benin-Bronzen.</div>
                        </figcaption>
                    </figure>
                    
                    <p class="mb-4 italic border-t border-gray-200 pt-4">In der nächsten Station werden sie sich tiefer mit der
                    Präsentation des „Exotischen“ beschäftigen und können sehen, wie diese „museale“
                    Wissenschaft als Fundament für gesellschaftliche Ansichten sein kann.</p>
                `,
                audio: "audio/station4.mp3", 
                model3d: "" 
            },
            { 
                id: 4, 
                title: "Station IV: Völkerschau", 
                coords: [52.27084, 8.04301], 
                short: "Völkerschauen in Osnabrück.", 
                image: "images/station5.jpg",
                imageCopyright: "",
                
                content: `
                    <p class="mb-4">Sie stehen nun vor der „Osnabrückhalle“. Hier wird regelmäßig zu Events geladen, bei denen die Osnabrücker Stadtbevölkerung zusammenkommt – ob Uniball, Kabarett, Musicals oder die Osnabrücker Grünkohlmahlzeit. Die Ränge sind stets voll und beliebt. Solche Stadthallen gibt es in jeder Stadt, bei denen Personen durch das Land reisen und ihr Programm vortragen. Eine Person, die vor 150 Jahren in so einer Stadthalle hätte auftreten können, war Carl Hagenbeck.</p>

                    <!-- BILD 1 -->
                    <figure class="my-8 p-2 bg-gray-50 rounded border border-gray-100">
                        <!-- HIER BILDNAME ÄNDERN -->
                        <img src="images/station4_hagenbeck1.jpg" alt="Historische Darstellung Völkerschau" class="mb-2 w-full h-auto rounded shadow-sm" onerror="this.onerror=null; this.src='https://placehold.co/600x400/e2e8f0/475569?text=BILD+NICHT+GEFUNDEN';" />
                        <figcaption>
                            <div class="text-[10px] uppercase tracking-wider text-gray-400 font-bold border-b border-gray-200 pb-1 mb-1">Quelle: Archiv</div>
                            <div class="text-sm italic text-gray-700">Die erste Völkerschau 1874.</div>
                        </figcaption>
                    </figure>

                    <p class="mb-4">Carl Hagenbeck war im 19. Jahrhundert einer der bekanntesten Tierhändler Deutschlands. Er schickte regelmäßig Expeditionen rund um den Globus, um Tiere für seine Präsentationen zu fangen. Am 11. März 1874 jedoch präsentierte Hagenbeck keine Tiere. Er veranstaltete in Hamburg die erste sogenannte „Völkerschau“, bei der er statt seiner Tiere aus Nordskandinavien stammende Personen zur Schau stellte. Die Menschen waren zunächst irritiert, da sie eigentlich Tiere erwarteten, jedoch schlug die Stimmung in schiere Begeisterung um.</p>

                    <p class="mb-4">Die „Menschenschau“ wurde zum Erfolg. Menschen strömten in Scharen zu Hagenbeck, der nun regelmäßig Menschen verschiedenster Herkunft präsentierte. Hagenbeck nahm die Menschen, die ähnlich wie die Expeditionen der Tiere rund um die Welt gesucht wurden, zu sich in den Zoo und präsentierte ihr „alltägliches Leben“ mit allen rassistischen Klischees, die zu dieser Zeit vorherrschten. Warum die Menschen sich von Hagenbeck überreden lassen haben, ist nicht bekannt. Man nimmt an, dass sie unter falschen Versprechungen zu Hagenbeck gelockt wurden.</p>

                    <!-- BILD 2 -->
                    <figure class="my-8 p-2 bg-gray-50 rounded border border-gray-100">
                        <!-- HIER BILDNAME ÄNDERN -->
                        <img src="images/station4_plakat.jpg" alt="Plakat einer Völkerschau" class="mb-2 w-full h-auto rounded shadow-sm" onerror="this.onerror=null; this.src='https://placehold.co/600x400/e2e8f0/475569?text=BILD+NICHT+GEFUNDEN';" />
                        <figcaption>
                            <div class="text-[10px] uppercase tracking-wider text-gray-400 font-bold border-b border-gray-200 pb-1 mb-1">Quelle: Archiv</div>
                            <div class="text-sm italic text-gray-700">Werbeplakat für eine Völkerschau.</div>
                        </figcaption>
                    </figure>

                    <p class="mb-4">Wie Sie eben bei Station IV erfahren haben, hatte die Bildungsinstitution „Museum“ einen großen Einfluss auf dieses Menschenbild. Auch hier gilt: Hauptmotivation war die Attraktion des „Exotischen“. Das rassistische Weltbild wird unter anderem durch die Museen wissenschaftlich legitimiert. Die Museen geben somit die Wertvorstellung vor und Hagenbeck bedient sich der rassistischen Bilder im Kopf der Menschen und bietet die Attraktion in persona.</p>

                    <p class="mb-4">Aufgrund dessen hat die „Völkerschau“ nicht nur in Hamburg großen Erfolg, sondern erfreut sich bald in ganz Europa an Beliebtheit. So tourte Hagenbeck mit seiner Völkerschau „Die Wilden von den Feuerlandsinseln“ aus den Jahren 1881/1882 durch die großen europäischen Städte wie Paris, Berlin oder Zürich. Bei dieser menschenverachtenden Veranstaltung wurde eine Gruppe von elf Kawasqar, einer ethnischen Gruppe aus Südamerika, öffentlich zur Schau gestellt. Als Hagenbeck Zürich erreichte, starben fünf der elf Personen, wohingegen die verbliebenen, darunter auch die Kinder der Versorbenen, weiter zur Schau gestellt wurden. Todesfälle sind bei Hagenbeck keine Seltenheit gewesen. Im vorangegangenen Jahr starben alle acht Personen, die als Inuit präsentiert wurden.</p>

                    <!-- BILD 3 -->
                    <figure class="my-8 p-2 bg-gray-50 rounded border border-gray-100">
                        <!-- HIER BILDNAME ÄNDERN -->
                        <img src="images/station4_stadthalle.jpg" alt="Stadthalle Osnabrück 1913" class="mb-2 w-full h-auto rounded shadow-sm" onerror="this.onerror=null; this.src='https://placehold.co/600x400/e2e8f0/475569?text=BILD+NICHT+GEFUNDEN';" />
                        <figcaption>
                            <div class="text-[10px] uppercase tracking-wider text-gray-400 font-bold border-b border-gray-200 pb-1 mb-1">Quelle: Archiv</div>
                            <div class="text-sm italic text-gray-700">Nachgestellte Szene in der Osnabrücker Stadthalle, 1913.</div>
                        </figcaption>
                    </figure>
                    
                    <p class="mb-4">Die Völkerschauen waren bis in die 1930er Jahre sehr beliebt. Nachdem Carl Hagenbeck sich von den Völkerschauen offiziell als Initiator und Organisator zurückgezogen hatte, veranstaltete das Unternehmen Hagenbeck von 1875 bis 1931 bis zu 100 Menschenschauen. Es gab aber noch andere Unternehmen oder Personen, die Menschen auf rassistische Art und Weise in Völkerschauen präsentierten. Allein in Deutschland wurden bis zu 400 dieser Veranstaltungen organisiert, die durch die meisten der deutschen Städte tourten. Auch in Osnabrück fand das öffentliche Zurschaustellen von Menschen statt. 1893 präsentierte ein Forschungsreisender vor dem interessierten Publikum zwei Afrikanerinnen, als seien es „exotische Tiere“. 1913 lud man die Osnabrücker Bevölkerung zu einer Ausstellung ein, in der in der Stadthalle Hütten aufgebaut und dort Afrikanerinnen und Afrikaner zur Schau gestellt wurden.</p>
                `,
                audio: "audio/station5.mp3", 
                model3d: "" 
            },
            { 
                id: 5, 
                title: "Station V: Die Erdteilallegorien", 
                coords: [52.27107, 8.04422], 
                short: "Symbolik im Schlossgarten.", 
                image: "images/station6.jpg",
                imageCopyright: "",
                
                content: `
                    <p class="mb-4">Sie stehen nun im Schlossgarten. Er ist heute für viele Dreh- und Angelpunkt ihres Studiums – er liegt direkt neben einigen wichtigen Uni-Gebäuden und der Mensa. Außerdem bietet er im Sommer die Möglichkeit, an der frischen Luft und im grünen Gras zu lernen oder sich mit seinen Kommiliton*innen die Zeit zu verbringen.</p> 
                    
                    <p class="mb-4">Der Schlossgarten wird von vier Figuren vor dem Schloss gekrönt. Es handelt sich dabei um sogenannte Erdteilallegorien, eine Verkörperung unserer Kontinente. Sie stammen aus dem Jahr 1740 und stellen von links nach rechts Europa, Afrika, Amerika und Asien dar. Auf den ersten Blick mag man nicht direkt koloniale Überbleibsel oder rassistische Strukturen erkennen, doch der Schein trügt gewaltig. Sie verkörpern das kolonial-rassistische Denken in einer eher subtileren Art und Weise. Aber schauen wir uns die Figuren Schritt für Schritt an.</p>

                    <!-- BILD 1: EUROPA -->
                    <figure class="my-8 p-2 bg-gray-50 rounded border border-gray-100">
                        <!-- HIER BILDNAME ÄNDERN -->
                        <img src="images/station5_europa.jpg" alt="Allegorie Europa" class="mb-2 w-full h-auto rounded shadow-sm" onerror="this.onerror=null; this.src='https://placehold.co/600x400/e2e8f0/475569?text=BILD+NICHT+GEFUNDEN';" />
                        <figcaption>
                            <div class="text-[10px] uppercase tracking-wider text-gray-400 font-bold border-b border-gray-200 pb-1 mb-1">Quelle: Archiv</div>
                            <div class="text-sm italic text-gray-700">Die erste Darstellung von links: Europa.</div>
                        </figcaption>
                    </figure>

                    <p class="mb-4">Die erste Darstellung von links zeigt Europa. Sie ist die einzige Figur, die komplett bekleidet ist. Sie trägt eine römische Toga, ein Symbol für das alte Rom mit ebenfalls imperialistischen Ansprüchen. Gleichzeitig hält die Statue Herrschaftssymbole in Form eines Schildes und einer Krone in der Hand.</p>

                    <!-- BILD 2: AFRIKA -->
                    <figure class="my-8 p-2 bg-gray-50 rounded border border-gray-100">
                        <!-- HIER BILDNAME ÄNDERN -->
                        <img src="images/station5_afrika.jpg" alt="Allegorie Afrika" class="mb-2 w-full h-auto rounded shadow-sm" onerror="this.onerror=null; this.src='https://placehold.co/600x400/e2e8f0/475569?text=BILD+NICHT+GEFUNDEN';" />
                        <figcaption>
                            <div class="text-[10px] uppercase tracking-wider text-gray-400 font-bold border-b border-gray-200 pb-1 mb-1">Quelle: Archiv</div>
                            <div class="text-sm italic text-gray-700">Die Darstellung Afrikas.</div>
                        </figcaption>
                    </figure>

                    <p class="mb-4">Die weibliche Darstellung Afrikas sieht im Vergleich zu Europa ganz anders aus. Sie ist kaum bekleidet und weist stereotypische Gesichtsmerkmale auf. Das Ambivalent der vergleichsweise „starken“ Symbole in Form eines Schildes oder der Krone von Europa sind in der Darstellung Afrikas eher einfache Merkmale wie ein Armreif oder Haarschmuck. Der zu Boden liegende Löwe soll „das Wilde“ bzw. „animalische“ symbolisieren.</p>

                    <!-- BILD 3: AMERIKA -->
                    <figure class="my-8 p-2 bg-gray-50 rounded border border-gray-100">
                        <!-- HIER BILDNAME ÄNDERN -->
                        <img src="images/station5_amerika.jpg" alt="Allegorie Amerika" class="mb-2 w-full h-auto rounded shadow-sm" onerror="this.onerror=null; this.src='https://placehold.co/600x400/e2e8f0/475569?text=BILD+NICHT+GEFUNDEN';" />
                        <figcaption>
                            <div class="text-[10px] uppercase tracking-wider text-gray-400 font-bold border-b border-gray-200 pb-1 mb-1">Quelle: Archiv</div>
                            <div class="text-sm italic text-gray-700">Die Darstellung Amerikas.</div>
                        </figcaption>
                    </figure>

                    <p class="mb-4">Die Verkörperung Amerikas bedient ähnliche stereotypische und rassistische Merkmale. Der Kopf der Figur wird von Federschmuck geziert. Die Statue trägt zwar einen Federrock, wird aber dennoch sehr freizügig dargestellt. Der Aspekt der Wildnis findet sich auch hier in Form eines Bogens wieder. Zu ihren Füßen befinden sich ein Krokodil, ebenfalls ein Zeichen der Wildnis, und ein menschlicher Schädel. Dieser bedient die koloniale Vorstellung des angeblich in Amerika vorherrschenden Kannibalismus.</p>

                    <!-- BILD 4: ASIEN -->
                    <figure class="my-8 p-2 bg-gray-50 rounded border border-gray-100">
                        <!-- HIER BILDNAME ÄNDERN -->
                        <img src="images/station5_asien.jpg" alt="Allegorie Asien" class="mb-2 w-full h-auto rounded shadow-sm" onerror="this.onerror=null; this.src='https://placehold.co/600x400/e2e8f0/475569?text=BILD+NICHT+GEFUNDEN';" />
                        <figcaption>
                            <div class="text-[10px] uppercase tracking-wider text-gray-400 font-bold border-b border-gray-200 pb-1 mb-1">Quelle: Archiv</div>
                            <div class="text-sm italic text-gray-700">Die Darstellung Asiens.</div>
                        </figcaption>
                    </figure>

                    <p class="mb-4">Die asiatische Statue weist wieder mehr Bekleidung als die vorigen beiden Figuren auf. Sie suggeriert ebenfalls im Vergleich zu Afrika und Amerika ein „zivilisiertes“ Erscheinungsbild. Zu ihren Füßen befindet sich ein Turban und sie hält ein rauchendes Gefäß in der Hand, welches den Handel mit Asien symbolisiert. Güter aus Asien sind im 18. Jahrhundert in Europa sehr beliebt gewesen. Zwar zeigt die Figur einen gewissen „Grad an Zivilisation“ auf, ordnet sich dennoch Europa unter, da sie keine vergleichbaren Herrschersymbole aufweisen kann.</p>

                    <p class="mb-4">Insgesamt kann man an den Erdteilallegorien die zeitgenössische Weltanschauung erkennen. Die Figuren stehen für einen „Entwicklungsstand“ der Kontinente. Während Afrika und Amerika, noch in der Wildnis lebend (Tiere am Boden, Bogen, Schädel), zivilisatorisch Europa deutlich unterlegen seien (kaum bekleidet), reiht sich Asien als „spiritueller und zivilisierter“ (große seidenartige Bekleidung, jedoch keine Herrscherinsignien) Kontinent ein. Lediglich Europa scheint in der Lage zu sein, Macht zu haben, auszuüben, durchzusetzen und schlussendlich sie auch zu erweitern.</p>
                    
                    <p class="mb-4 border-t border-gray-200 pt-4">Diese Figuren zeichnen ein längst veraltetes und rassistisches Weltbild. Sie stehen jedoch völlig unkommentiert an einem sehr frequentierten Platz im Herzen des akademischen Osnabrücks. Ohne genauere Betrachtung kann man nur schwer die stereotypische Darstellung der Kontinente erkennen und identifizieren (Australien galt hierbei noch nicht als eigener Kontinent, daher existiert davon auch keine Statue).</p>
                `,
                audio: "audio/station6.mp3", 
                model3d: "erdteil_scan" 
            }
        ];

        const lightLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', { attribution: '© CARTO' });
        const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: '© Esri' });

        const map = L.map('map', { zoomControl: false, layers: [lightLayer] }).setView([52.277, 8.042], 15);
        L.control.layers({ "Archiv": lightLayer, "Satellit": satelliteLayer }, null, { position: 'topright' }).addTo(map);
        L.control.zoom({ position: 'topright' }).addTo(map);

        let userLocation = null;
        let routingControl = null;
        let userMarker = null;
        let currentHighlightLayer = null; 
        let lastTriggeredStationId = null; 

        // --- TUTORIAL LOGIK ---
        let currentStepIndex = 0;
        const tutorialSteps = [
            {
                elementId: 'sidebar', // Desktop Ziel
                altElementId: 'toggleSidebar', // Mobile Ziel
                title: 'Historische Stationen',
                text: 'Hier finden Sie alle Orte der Tour. Wählen Sie einen Eintrag aus, um mehr über die Geschichte und kolonialen Hintergründe zu erfahren.'
            },
            {
                elementId: 'map', 
                title: 'Interaktive Karte',
                text: 'Die Karte zeigt Ihnen die Standorte im heutigen Stadtbild. Sie können zoomen und die Marker anklicken.'
            },
            {
                selector: '.leaflet-control-layers',
                title: 'Zeitreise-Ansicht',
                text: 'Wechseln Sie hier oben rechts zwischen der reduzierten Archiv-Karte und aktuellen Satellitenbildern.'
            },
            {
                elementId: 'navigator-panel',
                title: 'GPS-Navigator',
                text: 'Starten Sie hier den Tour-Modus. Sobald Sie Ihr GPS aktivieren, zeigen wir Ihnen den Weg und die Entfernung zur nächsten Station.'
            }
        ];

        function startTutorial() {
            document.getElementById('tutorial-overlay').classList.add('active');
            currentStepIndex = 0;
            renderTutorialStep();
        }

        function endTutorial() {
            document.getElementById('tutorial-overlay').classList.remove('active');
        }

        function renderTutorialStep() {
            const step = tutorialSteps[currentStepIndex];
            const spotlight = document.getElementById('tutorial-spotlight');
            const tooltip = document.getElementById('tutorial-tooltip');
            
            let target = null;
            if (step.elementId) target = document.getElementById(step.elementId);
            if (step.selector) target = document.querySelector(step.selector);
            
            const isMobile = window.innerWidth < 768;
            if (isMobile && step.altElementId) {
                target = document.getElementById(step.altElementId);
            }

            if (!target) {
                console.error("Tutorial target not found", step);
                endTutorial();
                return;
            }

            const rect = target.getBoundingClientRect();
            
            spotlight.style.width = rect.width + 'px';
            spotlight.style.height = rect.height + 'px';
            spotlight.style.top = rect.top + 'px';
            spotlight.style.left = rect.left + 'px';

            document.getElementById('tut-title').innerText = step.title;
            document.getElementById('tut-text').innerText = step.text;
            
            const nextBtn = document.getElementById('tut-next');
            nextBtn.innerText = (currentStepIndex === tutorialSteps.length - 1) ? "Starten" : "Weiter";

            const tooltipWidth = 340; 
            const tooltipHeight = 200; 
            let top = rect.top;
            let left = rect.right + 20;

            if (left + tooltipWidth > window.innerWidth) {
                left = rect.left - tooltipWidth - 20;
                if (left < 0) {
                    left = 20;
                    if (rect.bottom + tooltipHeight < window.innerHeight) {
                        top = rect.bottom + 20;
                    } else {
                        top = rect.top - tooltipHeight - 20;
                    }
                }
            }
            if (top < 10) top = 10;
            if (top + tooltipHeight > window.innerHeight) top = window.innerHeight - tooltipHeight - 20;

            tooltip.style.top = top + 'px';
            tooltip.style.left = left + 'px';
        }

        document.getElementById('tut-next').onclick = () => {
            if (currentStepIndex < tutorialSteps.length - 1) {
                currentStepIndex++;
                renderTutorialStep();
            } else {
                endTutorial();
            }
        };
        document.getElementById('tut-skip').onclick = endTutorial;


        // --- INIT & LOGIC ---

        function initApp() {
            // Overlay Logic
            document.getElementById('openLit').onclick = () => document.getElementById('lit-overlay').classList.add('active');
            document.getElementById('closeLit').onclick = () => document.getElementById('lit-overlay').classList.remove('active');
            
            document.getElementById('closeStation').onclick = () => document.getElementById('station-overlay').classList.remove('active');

            // NEU: End Tour Logic
            document.getElementById('closeEndTour').onclick = () => document.getElementById('end-tour-overlay').classList.remove('active');
            
            document.getElementById('confirmEndTour').onclick = () => {
                document.getElementById('end-tour-overlay').classList.remove('active');
                document.getElementById('station-overlay').classList.remove('active');
                // Optional: Zurücksetzen auf Startansicht oder Intro
                map.flyTo([52.277, 8.042], 15);
                document.getElementById('intro-overlay').classList.remove('fade-out'); // Intro wieder zeigen
                setTimeout(() => document.getElementById('intro-overlay').style.visibility = 'visible', 0); // Fix für visibility transition
            };

            // FULLSCREEN LOGIC
            document.getElementById('closeFullscreen').onclick = () => {
                document.getElementById('fullscreen-overlay').classList.add('hidden');
            };

            // Arrival Prompt Logic
            document.getElementById('closeArrival').onclick = () => {
                document.getElementById('arrival-prompt').classList.remove('visible');
                // Temporarily disable auto-trigger to avoid spamming
                setTimeout(() => { lastTriggeredStationId = null; }, 60000); 
            };

            // Nur Lit Overlay soll bei Klick außen schließen
            document.getElementById('lit-overlay').addEventListener('click', function(e) {
                if(e.target === this) this.classList.remove('active');
            });
            // Station Overlay nicht, damit man die Karte bedienen kann. Nur X Button schließt.

            document.getElementById('closeIntro').onclick = () => {
                document.getElementById('intro-overlay').classList.add('fade-out');
                setTimeout(() => startTutorial(), 600);
            };

            const listContainer = document.getElementById('station-list');
            stations.forEach(station => {
                
                // MARKER LOGIC: Nur für Stationen mit ID > 0
                if (station.id !== 0) {
                    const icon = L.divIcon({
                        className: 'number-icon',
                        html: station.id,
                        iconSize: [30, 30],
                        iconAnchor: [15, 15],
                        popupAnchor: [0, -20]
                    });

                    // FINAL: Draggable deaktiviert
                    const marker = L.marker(station.coords, { icon: icon, draggable: false }).addTo(map);
                    
                    marker.on('click', () => showDetail(station.id));
                }

                // LIST CARD LOGIC: Für ALLE Stationen (inkl. 0)
                const card = document.createElement('div');
                card.className = 'station-card p-4 bg-white border border-gray-100 rounded shadow-sm cursor-pointer transition';
                card.innerHTML = `<h3 class="font-bold font-serif text-lg">${station.title}</h3><p class="text-[11px] text-gray-400">${station.short}</p>`;
                card.onclick = () => {
                    map.flyTo(station.coords, 17);
                    showDetail(station.id);
                };
                listContainer.appendChild(card);
            });

            // Initialisiere Drag Funktion für das Station Modal
            makeDraggable(document.getElementById("station-modal-content"));
        }

        // Hilfsfunktion für Fullscreen
        window.openFullscreen = function(src) {
            document.getElementById('fullscreen-image').src = src;
            document.getElementById('fullscreen-overlay').classList.remove('hidden');
        };

        function showDetail(id) {
            const station = stations.find(s => s.id === id);
            if (!station) return;

            document.getElementById('modal-title').innerText = station.title;
            document.getElementById('modal-content-text').innerHTML = station.content;
            
            const imgContainer = document.getElementById('modal-image-container');
            if (station.image) {
                // UPDATE: Mit onclick Event für Fullscreen und Zoom-Cursor
                imgContainer.innerHTML = `<img src="${station.image}" class="w-auto h-auto max-w-full max-h-[50vh] object-contain shadow-md cursor-zoom-in" alt="${station.title}" onclick="openFullscreen('${station.image}')" onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\\'text-gray-400 italic p-4 text-center\\'>Bild nicht gefunden:<br>${station.image}</div>'">`;
                
                // Add magnifying glass overlay (via CSS classes in HTML above, logic here ensures structure)
                const overlayDiv = document.createElement('div');
                overlayDiv.className = "absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-10 transition-all flex items-center justify-center pointer-events-none";
                overlayDiv.innerHTML = `<svg class="text-white opacity-0 transition-opacity drop-shadow-md" style="opacity: 0;" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>`;
                
                // Hover effect logic needed since innerHTML rebuilds
                
                imgContainer.innerHTML = `
                    <div class="relative group cursor-zoom-in" onclick="openFullscreen('${station.image}')">
                        <img src="${station.image}" class="w-auto h-auto max-w-full max-h-[50vh] object-contain shadow-md" alt="${station.title}" onerror="this.onerror=null; this.closest('#modal-image-container').innerHTML='<div class=\\'text-gray-400 italic p-4 text-center\\'>Bild nicht gefunden:<br>${station.image}</div>'">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all flex items-center justify-center">
                            <svg class="text-white opacity-0 group-hover:opacity-100 transition-opacity drop-shadow-lg" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="11" y1="8" x2="11" y2="14"></line><line x1="8" y1="11" x2="14" y2="11"></line></svg>
                        </div>
                    </div>
                `;
                
                imgContainer.classList.remove('hidden');
            } else {
                imgContainer.classList.add('hidden');
            }

            // --- BILDNACHWEIS LOGIK ---
            const captionContainer = document.getElementById('modal-image-copyright');
            if (station.image && station.imageCopyright) {
                captionContainer.innerText = "Foto: " + station.imageCopyright;
                captionContainer.classList.remove('hidden');
            } else {
                captionContainer.classList.add('hidden');
            }

            const mediaContainer = document.getElementById('modal-media');
            mediaContainer.innerHTML = '';
            
            if (station.audio || station.model3d) {
                mediaContainer.classList.remove('hidden');
                mediaContainer.innerHTML = `<h4 class="font-serif font-bold mb-3 text-sm border-b border-gray-200 pb-1">Multimediale Inhalte</h4>`;
                
                // --- CUSTOM AUDIO PLAYER ---
                if (station.audio) {
                    const audioDiv = document.createElement('div');
                    audioDiv.className = 'mb-3 custom-audio-player bg-[#fdfcf9] border border-[#e5e5e5] rounded-lg p-3 flex items-center gap-3 shadow-sm';
                    audioDiv.innerHTML = `
                        <button class="play-btn w-10 h-10 flex items-center justify-center bg-[#a67c00] text-white rounded-full hover:bg-[#856300] transition-colors flex-shrink-0 focus:outline-none">
                            <svg class="w-4 h-4 ml-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                        </button>
                        <div class="flex-grow flex flex-col justify-center">
                            <div class="text-[10px] uppercase tracking-wider text-gray-400 font-bold mb-1">Audio-Guide</div>
                            <div class="relative w-full h-1.5 bg-gray-200 rounded-full overflow-hidden cursor-pointer" id="progress-container">
                                <div class="progress-bar absolute top-0 left-0 h-full bg-[#a67c00] w-0 transition-all duration-100"></div>
                            </div>
                        </div>
                        <span class="time-display text-xs text-gray-500 font-mono w-10 text-right">0:00</span>
                        <audio src="${station.audio}" preload="metadata"></audio>
                    `;
                    mediaContainer.appendChild(audioDiv);

                    // Add Audio Logic
                    const audioEl = audioDiv.querySelector('audio');
                    const playBtn = audioDiv.querySelector('.play-btn');
                    const progressBar = audioDiv.querySelector('.progress-bar');
                    const progressContainer = audioDiv.querySelector('#progress-container');
                    const timeDisplay = audioDiv.querySelector('.time-display');
                    
                    const playIcon = `<svg class="w-4 h-4 ml-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>`;
                    const pauseIcon = `<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>`;

                    playBtn.onclick = () => {
                        if (audioEl.paused) {
                            audioEl.play();
                            playBtn.innerHTML = pauseIcon;
                        } else {
                            audioEl.pause();
                            playBtn.innerHTML = playIcon;
                        }
                    };

                    audioEl.ontimeupdate = () => {
                        const percent = (audioEl.currentTime / audioEl.duration) * 100;
                        progressBar.style.width = percent + "%";
                        
                        // Time Format
                        let mins = Math.floor(audioEl.currentTime / 60);
                        let secs = Math.floor(audioEl.currentTime % 60);
                        if (secs < 10) secs = "0" + secs;
                        timeDisplay.innerText = mins + ":" + secs;
                    };

                    audioEl.onended = () => {
                        playBtn.innerHTML = playIcon;
                        progressBar.style.width = "0%";
                    };
                    
                    // Simple Seek functionality
                    progressContainer.onclick = (e) => {
                        const width = progressContainer.clientWidth;
                        const clickX = e.offsetX;
                        const duration = audioEl.duration;
                        audioEl.currentTime = (clickX / width) * duration;
                    };
                }

                if (station.model3d) {
                    const modelBtn = document.createElement('button');
                    modelBtn.className = 'w-full py-2 border border-[#a67c00] text-[#a67c00] rounded hover:bg-[#a67c00] hover:text-white transition flex items-center justify-center gap-2 text-sm font-medium';
                    modelBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.5 22.37a.997.997 0 0 0 .5 0l7.5-4a1 1 0 0 0 .5-.86v-8l-8 4.25-8-4.25v8a1 1 0 0 0 .5.86l7.5 4Z"/><path d="M3 7l9-5 9 5M12 22V12"/></svg> 3D-Scan ansehen`;
                    modelBtn.onclick = () => {
                         showToast("Platzhalter: 3D-Viewer für Modell " + station.model3d);
                    };
                    mediaContainer.appendChild(modelBtn);
                }
            } else {
                mediaContainer.classList.add('hidden');
            }

            // NAVIGATION BUTTONS LOGIC
            const currentIndex = stations.findIndex(s => s.id === id);
            let nextStation = stations[currentIndex + 1];

            // NEU: Loop-Logik (Wenn am Ende, springe zu Station 1, nicht 0/Intro)
            if (!nextStation && currentIndex === stations.length - 1) {
                nextStation = stations.find(s => s.id === 1);
            }
            
            const nextBtn = document.getElementById('modal-next-btn');
            
            if (nextStation) {
                nextBtn.innerHTML = `<span>Zur nächsten Station: ${nextStation.title}</span><svg class="ml-2 group-hover:translate-x-1 transition-transform" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>`;
                nextBtn.onclick = () => {
                    document.getElementById('station-overlay').classList.remove('active');
                    // MODIFIZIERT: Startet Route von aktueller Station zur nächsten (für Screenshots/Tour-Modus)
                    startRoute(nextStation.coords, station.coords);
                };
                nextBtn.classList.remove('hidden');
            } else {
                // Fallback, falls Loop Logik versagt oder Station 0
                nextBtn.innerHTML = `<span>Rundgang beendet</span>`;
                nextBtn.onclick = () => document.getElementById('station-overlay').classList.remove('active');
            }

            // Standard Navigation button (to this station)
            document.getElementById('modal-navigate-btn').onclick = () => {
                document.getElementById('station-overlay').classList.remove('active');
                startRoute(station.coords);
            };

            // NEU: End Tour Button Event
            document.getElementById('modal-end-btn').onclick = () => {
                // Station Overlay schließen (optional, kann auch offen bleiben)
                // document.getElementById('station-overlay').classList.remove('active');
                document.getElementById('end-tour-overlay').classList.add('active');
            };

            // Show Modal - Reset Position to center when opening new
            const modalContent = document.getElementById("station-modal-content");
            modalContent.style.top = "50%";
            modalContent.style.left = "50%";
            modalContent.style.transform = "translate(-50%, -50%)";

            document.getElementById('station-overlay').classList.add('active');
        }

        function showArrivalPrompt(station) {
            const prompt = document.getElementById('arrival-prompt');
            document.getElementById('arrival-station-name').innerText = station.title;
            
            // Setup Open Action
            document.getElementById('openArrival').onclick = () => {
                prompt.classList.remove('visible');
                showDetail(station.id);
            };

            prompt.classList.add('visible');
        }

        function showToast(text) {
            const toast = document.getElementById('toast');
            toast.innerText = text; toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 3000);
        }

        function updateNavigator() {
            if (!userLocation) return;
            document.getElementById('nav-initial-state').classList.add('hidden');
            document.getElementById('nav-active-state').classList.remove('hidden');

            let nearest = null;
            let minDist = Infinity;
            stations.forEach(s => {
                const dist = L.latLng(userLocation.lat, userLocation.lng).distanceTo(L.latLng(s.coords[0], s.coords[1]));
                if (dist < minDist) { minDist = dist; nearest = s; }
            });

            if (nearest) {
                document.getElementById('nav-next-title').innerText = nearest.title;
                const distText = minDist > 1000 ? (minDist/1000).toFixed(1) + " km" : Math.round(minDist) + " m";
                document.getElementById('nav-dist').innerText = distText;
                const minutes = Math.ceil(minDist / 80);
                document.getElementById('nav-time').innerText = minutes + " Min.";
                
                const statusText = document.getElementById('nav-status-text');
                
                if (minDist < 40) { // Arrival Zone
                    statusText.innerHTML = `<span class="h-2 w-2 rounded-full bg-red-600 animate-pulse mr-2"></span> Ziel erreicht!`;
                    statusText.classList.remove('text-green-600');
                    statusText.classList.add('text-red-600');

                    if (!currentHighlightLayer || currentHighlightLayer._latlng.lat !== nearest.coords[0]) {
                        if (currentHighlightLayer) map.removeLayer(currentHighlightLayer);
                        currentHighlightLayer = L.circle(nearest.coords, {
                            color: '#e74c3c', fillColor: '#c0392b', fillOpacity: 0.3, radius: 35, className: 'arrival-marker'
                        }).addTo(map);
                        
                        // NEW: Prompt instead of auto-open
                        if (lastTriggeredStationId !== nearest.id) {
                            showArrivalPrompt(nearest);
                            lastTriggeredStationId = nearest.id;
                        }
                    }
                } else {
                    statusText.innerHTML = `<span class="h-1.5 w-1.5 rounded-full bg-green-600 mr-1"></span> Aktiv`;
                    statusText.classList.add('text-green-600');
                    statusText.classList.remove('text-red-600');
                    if (currentHighlightLayer) {
                        map.removeLayer(currentHighlightLayer);
                        currentHighlightLayer = null;
                        
                        // Only reset if we move away significantly to avoid flicker? 
                        // For now, reset when leaving the zone is fine.
                        // lastTriggeredStationId = null; // Removed to prevent re-triggering if user just walks back and forth. 
                    }
                    // Hide prompt if user walks away without clicking
                    document.getElementById('arrival-prompt').classList.remove('visible');
                }
            }
        }

        function startRoute(destCoords, startCoords = null) {
            // Wenn startCoords übergeben, nutze diese (Simulations/Screenshot-Modus)
            // Sonst nutze userLocation (GPS-Modus)
            let start = null;
            
            if (startCoords) {
                start = L.latLng(startCoords[0], startCoords[1]);
            } else if (userLocation) {
                start = L.latLng(userLocation.lat, userLocation.lng);
            }

            if (!start) { showToast("Bitte erst GPS aktivieren."); return; }
            
            if (routingControl) map.removeControl(routingControl);
            
            showToast("Berechne Route...");

            routingControl = L.Routing.control({
                waypoints: [start, L.latLng(destCoords[0], destCoords[1])],
                createMarker: () => null,
                language: 'de',
                router: L.Routing.osrmv1({
                    serviceUrl: 'https://routing.openstreetmap.de/routed-foot/route/v1',
                    profile: 'foot' 
                }),
                lineOptions: { 
                    styles: [{ color: '#d60000', opacity: 0.8, weight: 6 }],
                    extendToWaypoints: true,
                    missingRouteTolerance: 10
                },
                fitSelectedRoutes: true, // Zoomt automatisch auf die Route
                show: false // Versteckt das Text-Panel
            }).addTo(map);

            // Error Handling für Routing
            routingControl.on('routingerror', function(e) {
                console.error("Routing Error:", e);
                showToast("Fehler bei der Routenberechnung.");
            });
        }

        document.getElementById('locateMe').onclick = () => {
            if (!navigator.geolocation) return showToast("GPS nicht unterstützt.");
            navigator.geolocation.watchPosition((position) => {
                const { latitude, longitude } = position.coords;
                userLocation = { lat: latitude, lng: longitude };
                if (userMarker) userMarker.setLatLng([latitude, longitude]);
                else userMarker = L.circleMarker([latitude, longitude], { radius: 8, fillColor: "#3b82f6", color: "#fff", weight: 2, fillOpacity: 0.8 }).addTo(map);
                document.getElementById('gps-icon').setAttribute('stroke', '#3b82f6');
                updateNavigator();
            }, () => showToast("GPS Zugriff verweigert."), { enableHighAccuracy: true });
        };

        // Entfernt: BackToList (Wird durch Modal Close ersetzt)
        document.getElementById('toggleSidebar').onclick = () => document.getElementById('sidebar').classList.toggle('-translate-x-full');

        window.onload = initApp;
    </script>
</body>
</html>
