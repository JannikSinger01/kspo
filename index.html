<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Koloniale Spuren Osnabrück | Digitale Stadtführung</title>
    
    <!-- Tailwind CSS für das Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet CSS & JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Leaflet Routing Machine -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600&family=Inter:wght@300;400;600&display=swap');

        :root {
            --vintage-paper: #f4f1ea;
            --charcoal: #2d3436;
            --accent-gold: #a67c00;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--vintage-paper);
            color: var(--charcoal);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        h1, h2, h3 {
            font-family: 'Crimson Pro', serif;
        }

        #map {
            flex-grow: 1;
            z-index: 1;
        }

        .custom-popup .leaflet-popup-content-wrapper {
            background: var(--vintage-paper);
            color: var(--charcoal);
            border-radius: 4px;
            border: 1px solid var(--accent-gold);
        }

        /* Sidebar Glassmorphism */
        .sidebar {
            transition: transform 0.3s ease-in-out;
            z-index: 1000;
        }

        .station-card:hover {
            border-left: 4px solid var(--accent-gold);
            background: rgba(166, 124, 0, 0.05);
        }

        /* Verstecke Routing-Instruktionen standardmäßig auf Mobile */
        .leaflet-routing-container {
            display: none;
        }
        
        .active-route .leaflet-routing-container {
            display: block;
            max-height: 200px;
            overflow-y: auto;
            background: white !important;
            font-size: 12px;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="bg-[#2d3436] text-white p-4 shadow-md flex justify-between items-center relative z-[1001]">
        <div>
            <h1 class="text-xl md:text-2xl font-semibold tracking-tight">Koloniale Spuren Osnabrück</h1>
            <p class="text-xs text-gray-400 font-light italic">Ein geschichtswissenschaftliches Projekt zur Stadtführung</p>
        </div>
        <button id="toggleSidebar" class="md:hidden bg-accent-gold p-2 rounded">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
        </button>
    </header>

    <main class="flex flex-1 relative">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar absolute md:relative w-full md:w-96 bg-[#fdfcf9] border-r border-gray-200 h-full overflow-y-auto transform -translate-x-full md:translate-x-0 shadow-xl">
            <div class="p-6">
                <div id="intro-view">
                    <h2 class="text-2xl mb-4 border-b border-gray-200 pb-2">Stationen der Tour</h2>
                    <p class="text-sm text-gray-600 mb-6">Wählen Sie einen Ort auf der Karte oder aus der Liste, um mehr über die kolonialen Verflechtungen Osnabrücks zu erfahren.</p>
                    
                    <div id="station-list" class="space-y-4">
                        <!-- Stationen werden dynamisch geladen -->
                    </div>
                </div>

                <!-- Detail View (Hidden by default) -->
                <div id="detail-view" class="hidden">
                    <button id="backToList" class="text-sm text-accent-gold flex items-center mb-4 hover:underline">
                        <svg class="mr-1" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg> Zurück zur Übersicht
                    </button>
                    <h2 id="detail-title" class="text-2xl mb-2"></h2>
                    <div id="detail-image" class="w-full h-48 bg-gray-200 rounded mb-4 overflow-hidden flex items-center justify-center italic text-gray-500 text-sm">
                        [Bildplatzhalter: Historische Ansicht]
                    </div>
                    <div id="detail-content" class="text-sm leading-relaxed text-gray-700 space-y-4">
                        <!-- Inhalt -->
                    </div>
                    <div class="mt-8 pt-4 border-t border-gray-200">
                        <button id="startNavigation" class="w-full bg-[#2d3436] text-white py-3 rounded-lg flex justify-center items-center hover:bg-black transition">
                            <svg class="mr-2" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 7 9 5 9-5V5l-9 5-9-5v2Z"/><path d="M21 7v10l-9 5-9-5V7l9 5 9-5Z"/></svg>
                            Wegbeschreibung starten
                        </button>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Map Container -->
        <div id="map"></div>

        <!-- GPS Button Overlay -->
        <button id="locateMe" class="absolute bottom-8 right-8 z-[1000] bg-white p-4 rounded-full shadow-2xl border border-gray-200 hover:bg-gray-50 active:scale-95 transition-transform">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#a67c00" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="3"></circle><line x1="12" y1="2" x2="12" y2="4"></line><line x1="12" y1="20" x2="12" y2="22"></line><line x1="2" y1="12" x2="4" y2="12"></line><line x1="20" y1="12" x2="22" y2="12"></line></svg>
        </button>
    </main>

    <!-- UI Overlay for Notifications -->
    <div id="toast" class="fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-full text-sm opacity-0 transition-opacity z-[2000] pointer-events-none">
        Standort wird abgerufen...
    </div>

    <script>
        // --- DATEN DER STATIONEN ---
        const stations = [
            {
                id: 1,
                title: "Marktplatz & Rathaus",
                coords: [52.2776, 8.0411],
                short: "Zentrum des Westfälischen Friedens und Handelswege.",
                content: "<p>Das Rathaus des Westfälischen Friedens ist nicht nur ein Symbol der Diplomatie. Als Handelsstadt profitierte Osnabrück indirekt von kolonialen Warenströmen, die über die Hanse und später norddeutsche Häfen flossen.</p><p>Historische Akten belegen, dass auch Osnabrücker Kaufleute in den Überseehandel investierten, was zum Wohlstand der Stadt im 18. und 19. Jahrhundert beitrug.</p>"
            },
            {
                id: 2,
                title: "Bucksturm & Mahnmal",
                coords: [52.2745, 8.0385],
                short: "Ehemaliger Wehrturm mit Blick auf Gedenkkultur.",
                content: "<p>In der Nähe des Bucksturms finden sich Spuren der Auseinandersetzung mit der deutschen Kolonialvergangenheit. Oft wurden Denkmäler für 'Kolonialhelden' erst spät hinterfragt.</p><p>Dieser Ort dient heute als Reflexionspunkt für die Verbindung zwischen lokalem Militarismus und imperialen Bestrebungen des Kaiserreichs.</p>"
            },
            {
                id: 3,
                title: "Ledenhof",
                coords: [52.2725, 8.0445],
                short: "Adelssitz mit Verbindungen zur Überseewirtschaft.",
                content: "<p>Der Ledenhof, ein ehemaliger mittelalterlicher Stadthof, repräsentiert die Oberschicht Osnabrücks. Viele dieser Familien waren Akteure in globalen Netzwerken, die Kolonialwaren wie Tabak, Zucker und Kaffee nach Westfalen brachten.</p>"
            }
        ];

        // --- MAP INITIALISIERUNG ---
        const map = L.map('map', {
            zoomControl: false
        }).setView([52.277, 8.042], 15);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
        }).addTo(map);

        L.control.zoom({ position: 'topright' }).addTo(map);

        let userLocation = null;
        let routingControl = null;
        let userMarker = null;

        // --- FUNKTIONEN ---

        function initApp() {
            const listContainer = document.getElementById('station-list');
            
            stations.forEach(station => {
                // Marker hinzufügen
                const marker = L.marker(station.coords).addTo(map);
                marker.bindPopup(`<div class="font-semibold">${station.title}</div><button onclick="showDetail(${station.id})" class="text-accent-gold text-xs underline">Details ansehen</button>`, { className: 'custom-popup' });

                // Liste generieren
                const card = document.createElement('div');
                card.className = 'station-card p-4 bg-white border border-gray-100 rounded shadow-sm cursor-pointer transition';
                card.innerHTML = `
                    <h3 class="font-semibold text-lg">${station.title}</h3>
                    <p class="text-xs text-gray-500">${station.short}</p>
                `;
                card.onclick = () => {
                    showDetail(station.id);
                    map.flyTo(station.coords, 17);
                };
                listContainer.appendChild(card);
            });
        }

        function showDetail(id) {
            const station = stations.find(s => s.id === id);
            document.getElementById('intro-view').classList.add('hidden');
            document.getElementById('detail-view').classList.remove('hidden');
            
            document.getElementById('detail-title').innerText = station.title;
            document.getElementById('detail-content').innerHTML = station.content;

            // Navigation Button Setup
            document.getElementById('startNavigation').onclick = () => {
                startRoute(station.coords);
            };

            // Sidebar auf Mobile nach Klick einklappen (optional)
            if (window.innerWidth < 768) {
                // toggleSidebarVisibility(); // Falls gewünscht
            }
        }

        function showToast(text) {
            const toast = document.getElementById('toast');
            toast.innerText = text;
            toast.style.opacity = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 3000);
        }

        // --- NAVIGATION & GPS ---

        function startRoute(destCoords) {
            if (!userLocation) {
                showToast("Bitte aktivieren Sie erst Ihren Standort (Button unten rechts).");
                return;
            }

            if (routingControl) {
                map.removeControl(routingControl);
            }

            routingControl = L.Routing.control({
                waypoints: [
                    L.latLng(userLocation.lat, userLocation.lng),
                    L.latLng(destCoords[0], destCoords[1])
                ],
                routeWhileDragging: true,
                language: 'de',
                createMarker: function() { return null; }, // Verhindert doppelte Marker
                lineOptions: {
                    styles: [{ color: '#a67c00', opacity: 0.8, weight: 6 }]
                }
            }).addTo(map);

            showToast("Route berechnet. Folgen Sie der Linie.");
            document.body.classList.add('active-route');
        }

        // Standort finden
        document.getElementById('locateMe').onclick = () => {
            showToast("Suche Standort...");
            
            if (!navigator.geolocation) {
                showToast("Geolocation wird nicht unterstützt.");
                return;
            }

            navigator.geolocation.getCurrentPosition((position) => {
                const { latitude, longitude } = position.coords;
                userLocation = { lat: latitude, lng: longitude };

                if (userMarker) {
                    userMarker.setLatLng([latitude, longitude]);
                } else {
                    userMarker = L.circleMarker([latitude, longitude], {
                        radius: 8,
                        fillColor: "#3b82f6",
                        color: "#fff",
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.8
                    }).addTo(map);
                }

                map.flyTo([latitude, longitude], 16);
                showToast("Standort gefunden.");
            }, () => {
                showToast("Zugriff auf Standort verweigert.");
            });
        };

        // --- UI EVENTS ---

        document.getElementById('backToList').onclick = () => {
            document.getElementById('intro-view').classList.remove('hidden');
            document.getElementById('detail-view').classList.add('hidden');
            if (routingControl) {
                map.removeControl(routingControl);
                document.body.classList.remove('active-route');
            }
        };

        document.getElementById('toggleSidebar').onclick = toggleSidebarVisibility;

        function toggleSidebarVisibility() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('-translate-x-full');
        }

        // Initialisierung
        window.onload = initApp;

    </script>
</body>
</html>
